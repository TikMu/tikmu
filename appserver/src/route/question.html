<!DOCTYPE html>
<html>
@{ var teaser = question.contents.split("\n")[0].split(" ").slice(0, 4).join(" "); }
@ctx.aux.head.setData({ title : teaser + (teaser != question.contents ? "..." : "") }).execute()
<body>
	@ctx.aux.menu.execute()
	
	<div class="question_open">
		<div class="overlay"></div>
		@{ var u = this.getUser(question.user); var qid = question._id.valueOf(); }
		<article id="@qid" class="question question_open_inner"> 
			<header class="question_header">
				<div class="close_button"></div>
					<a class="close">&times;</a>
				<div class="user_avatar"></div>
				<div class="user_description">
					<div class="user_name">@u.name</div>
					<div class="user_reputation">@u.points</div>
				</div>
			</header>
			<p class="question_card_question">@question.contents</p>
			<footer>
				<div class="location_date">@Std.random(10)km @this.getPrettyDelta(question.created)</div>
				<div class="footer_icons">
					<a href="#answer_box" class="answer icon">Answer</a>
					<a href="#@qid" class="share icon">Share</a>
					@if(ctx.loop.session.isAuthenticated()) {
					@{
						var favclass = "favorite icon";
						var folclass = "follow icon";
						if (state != null) {
							if (state.favorite)
								favclass += " pressed";
							if (state.following)
								folclass += " pressed";
						}
					}
					<a class="@favclass">Favorite/unfavorite</a>
					<a class="@folclass">Follow/unfavorite</a>
					}
				</div>
			</footer>
			<section class="answer_list">
				@for (a in question.answers)
				{ @{ var u = this.getUser(a.user); var aid = a._id.valueOf(); }
				<article id="@aid" class="answer_container">
					<header>
						<div class="answer_user_name">@u.name</div>
						<div class="answer_user_date">@this.getPrettyDelta(a.created)</div>
					</header>
					
					<div class="answer_inner">
						<p class="answer_content">@a.contents</p>
					<div class="vote">	
						<div class="is-position-relative">							
							<span class="vote_count">@a.voteSum</span>
						@if(ctx.loop.session.isAuthenticated()) {
							@if(!ctx.loop.session.user.equals(a.user)) {
							@{
								var vote = votes[Lambda.indexOf(question.answers, a)];
								var upclass = "upvote";
								var dnclass = "downvote";
								if (vote > 0)
									upclass += " pressed";
								else if (vote < 0)
									dnclass += " pressed";
							}
						</div>
						<div class="is-position-relative">	
							<a class="@upclass icon"></a>
						</div>
						<div class="is-position-relative">
							<a class="@dnclass icon"></a>
						</div>
							}
						}
						</div>	<!-- vote -->
					</div> <!-- answer inner -->
							
					<div class="comment_icons">
					<a href="#" class="share_answer icon">Share</a>
						<a href="#" class="comment_answer" onclick="document.getElementById('@aid/comment').hidden = false">comment</a>
						<form id="@aid/comment" action="/answer/@aid/comment" method="post" hidden="true">
							<div class="comment_container">
								<div class="comment_avatar"></div>

							<input  class="comment_text" name="comment" type="text" placeholder="Write a comment..." />
							<button class="submit_comment"type="submit">Send</button>
							<!-- <button  type="button" onclick="document.getElementById('@aid/comment').hidden = true">></button> Implement this later -->
						</div>
						</form>
					</footer>
				</div>
					<section class="comment_list">
						@for (c in a.comments)
						{ @{var u = this.getUser(c.user); var cid = c._id.valueOf(); }
						<div class="background_comment">
						<article id="@cid" class="comment">
							<header>
								<div class="answer_user_name">@u.name</div>
								<div class="answer_user_date">@this.getPrettyDelta(c.created)</div>
							</header>
							<p class="comment_content">@c.contents</p>
						</article> <!-- comment  -->
						</div>
						}
					</section> <!-- comment list -->
				</article> <!-- answer containner -->
				}
			</section> <!-- answer_list -->
			<section class="answer_main_question">
			<form class="answer_box" action="/question/@qid/answer" method="post">
				<input name="answer" type="text" placeholder="Help this traveler!" class="answer_textinput" />
				<button type="submit" class="answer_submit_button">Send</button>
			</form>
			</section>

		</article> <!-- Question Open inner -->
	</div>  <!--  Question open -->
</body>
</html>

